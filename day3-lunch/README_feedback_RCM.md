Nice, elegant solution. The use of functions really improves the readability.

Same comment as before about the extra empty lines in the output--how could you avoid printing them?
